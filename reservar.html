<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#050508">
<title>Reservar ‚Äì COLESTUR</title>

<style>
  :root {
    --bg: #050508;
    --card: #0c0d11;
    --card-soft: #13141b;
    --accent: #3a7ce9;
    --text: #f4f6f9;
    --muted: #9ca3b5;
    --border: #1c1d25;
  }

  body {
    margin: 0;
    background: var(--bg);
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    color: var(--text);
  }

  /* HEADER */
  header {
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(10,10,14,0.6);
    border-bottom: 1px solid #0e1015;
    position: sticky;
    top: 0;
    z-index: 50;
  }

  .logo-circle {
    width: 38px;
    height: 38px;
    border-radius: 999px;
    background: linear-gradient(135deg, #ffeaa7, #f1c40f);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #111;
    font-weight: 800;
  }

  main {
    padding: 20px 16px 140px;
    max-width: 780px;
    margin: auto;
  }

  .trip-card {
    background: var(--card);
    padding: 18px;
    border-radius: 18px;
    border: 1px solid var(--border);
    margin-bottom: 22px;
  }

  label {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 6px;
    display: block;
  }

  input, select {
    width: 100%;
    padding: 12px;
    border-radius: 14px;
    background: var(--card-soft);
    border: 1px solid var(--border);
    color: var(--text);
  }

  #map {
    width: 100%;
    height: 300px;
    border-radius: 18px;
    margin-bottom: 18px;
    border: 1px solid var(--border);
  }

  .info-box {
    background: var(--card);
    padding: 14px;
    border-radius: 14px;
    border: 1px solid var(--border);
    margin-bottom: 20px;
  }

  .info-item {
    font-size: 15px;
    margin-bottom: 6px;
  }

  /* BOT√ìN CONFIRMAR */
  .confirm-container {
    position: fixed;
    bottom: 75px;
    left: 0;
    right: 0;
    padding: 0 18px;
    display: flex;
    justify-content: center;
    z-index: 9999;
  }

  .btn-confirm {
    width: 100%;
    background: var(--accent);
    padding: 15px;
    border: none;
    border-radius: 999px;
    color: white;
    font-weight: 700;
    font-size: 16px;
    box-shadow: 0 12px 28px rgba(58,124,233,.45);
  }

  /* BOTTOM NAV */
  .bottom-nav {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 65px;
    background: #0d0e12;
    border-top: 1px solid #1f2027;
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 99999;
  }

  .nav-item {
    text-align: center;
    font-size: 13px;
    color: var(--muted);
    text-decoration: none;
  }

  .nav-item span {
    font-size: 20px;
    display: block;
    margin-bottom: 2px;
  }

  .nav-active {
    color: white;
    font-weight: 600;
  }
</style>
</head>

<body>

<header>
  <div class="logo-circle">CR</div>
  <div>
    <div style="font-size:12px;color:var(--muted)">TRANSPORTE ESPECIAL</div>
    <div style="font-size:18px;font-weight:700">COLESTUR S.A.S.</div>
  </div>
</header>

<main>

  <section class="trip-card">
    <label>Punto de recogida</label>
    <input id="origen" placeholder="Cargando ubicaci√≥n..." />

    <label style="margin-top:14px;">Destino</label>
    <input id="destino" placeholder="¬øA d√≥nde vas?" />
  </section>

  <div id="map"></div>

  <div class="info-box">
    <div class="info-item">üìç <b>Distancia:</b> <span id="distancia">‚Äî</span></div>
    <div class="info-item">‚è± <b>Tiempo estimado:</b> <span id="tiempo">‚Äî</span></div>
  </div>

  <section class="trip-card">
    <label>Nombre completo</label>
    <input id="nombre" />

    <label style="margin-top:12px;">WhatsApp</label>
    <input id="telefono" type="tel" placeholder="57300..." />

    <label style="margin-top:12px;">Servicio</label>
    <select id="servicio">
      <option>Escolar</option>
      <option>Empresarial</option>
      <option>Turismo</option>
      <option>Aeropuerto</option>
    </select>

    <label style="margin-top:12px;">Fecha</label>
    <input type="date" id="fecha">

    <label style="margin-top:12px;">Hora</label>
    <input type="time" id="hora">

    <label style="margin-top:12px;">Pasajeros</label>
    <input type="number" id="pasajeros" value="1" min="1">
  </section>

</main>

<!-- BOT√ìN CONFIRMAR (por ahora solo hace console.log, luego lo conectamos a Firebase/Email) -->
<div class="confirm-container">
  <button id="btnReservar" class="btn-confirm">Confirmar reserva</button>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <a href="index.html" class="nav-item">
    <span>üè†</span> Inicio
  </a>
  <a href="reservar.html" class="nav-item nav-active">
    <span>üöå</span> Reservar
  </a>
  <a href="contacto.html" class="nav-item">
    <span>üìû</span> Contacto
  </a>
</div>

<!-- ========== MAPAS + AUTOCOMPLETE + RUTA AZUL ========== -->
<script>
let map, originMarker, destMarker;
let directionsService, directionsRenderer;
let acOrigen, acDestino;

// Se llama autom√°ticamente por el script de Google
function initMap() {
  directionsService  = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({
    suppressMarkers: true,
    polylineOptions: {
      strokeColor: "#3a7ce9",
      strokeWeight: 6
    }
  });

  // Mapa base, centrado en Bogot√° mientras tanto
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 4.711, lng: -74.0721 },
    zoom: 14,
    disableDefaultUI: true
  });

  directionsRenderer.setMap(map);

  const geocoder = new google.maps.Geocoder();

  // Intento de geolocalizaci√≥n
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
      setOrigin(loc);
      map.setCenter(loc);

      // Sesgo de autocompletado alrededor de tu zona (~30 km)
      const bounds = new google.maps.Circle({
        center: loc,
        radius: 30000
      }).getBounds();

      setupAutocomplete(bounds);

      // Convertir coordenadas a direcci√≥n para el input de origen
      geocoder.geocode({ location: loc }, (res, status) => {
        if (status === "OK" && res[0]) {
          document.getElementById("origen").value = res[0].formatted_address;
        }
      });
    },
    (err) => {
      console.warn("Error geolocalizaci√≥n:", err);

      // Si falla la ubicaci√≥n, usar centro Bogot√°
      const fallback = { lat: 4.711, lng: -74.0721 };
      setOrigin(fallback);
      map.setCenter(fallback);

      const bounds = new google.maps.Circle({
        center: fallback,
        radius: 30000
      }).getBounds();

      setupAutocomplete(bounds);
    },
    { enableHighAccuracy: true, timeout: 10000 }
  );

  // Por si el usuario escribe y da Enter sin seleccionar sugerencia:
  document.getElementById("origen").addEventListener("change", calcularRuta);
  document.getElementById("destino").addEventListener("change", calcularRuta);

  // Bot√≥n confirmar (de momento solo console.log)
  document.getElementById("btnReservar").addEventListener("click", () => {
    console.log("Confirmar reserva (luego conectamos Firebase/Email).");
    alert("Tu ruta est√° lista. Luego conectamos esta acci√≥n a la base de datos y al correo. üòâ");
  });
}

// Configura Autocomplete de origen y destino
function setupAutocomplete(bounds) {
  const opts = {
    fields: ["formatted_address", "geometry", "name"],
    componentRestrictions: { country: "co" },
    bounds: bounds,
    strictBounds: false
  };

  acOrigen = new google.maps.places.Autocomplete(
    document.getElementById("origen"),
    opts
  );
  acDestino = new google.maps.places.Autocomplete(
    document.getElementById("destino"),
    opts
  );

  acOrigen.addListener("place_changed", () => {
    const place = acOrigen.getPlace();
    if (!place || !place.geometry) return;

    document.getElementById("origen").value =
      place.formatted_address || place.name || document.getElementById("origen").value;

    setOrigin(place.geometry.location);
    calcularRuta();
  });

  acDestino.addListener("place_changed", () => {
    const place = acDestino.getPlace();
    if (!place || !place.geometry) return;

    document.getElementById("destino").value =
      place.formatted_address || place.name || document.getElementById("destino").value;

    setDestino(place.geometry.location);
    calcularRuta();
  });
}

/* ========= MARCADORES ========== */
function setOrigin(latLng) {
  if (!originMarker) {
    originMarker = new google.maps.Marker({
      position: latLng,
      map,
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 7,
        fillColor: "#3a7ce9",
        fillOpacity: 1,
        strokeColor: "#fff",
        strokeWeight: 2
      }
    });
  } else {
    originMarker.setPosition(latLng);
  }
}

function setDestino(latLng) {
  if (!destMarker) {
    destMarker = new google.maps.Marker({
      position: latLng,
      map,
      icon: {
        path: "M0 0 L 2 4 L 0 12 L -2 4 Z",
        fillColor: "#4bff8f",
        fillOpacity: 1
      }
    });
  } else {
    destMarker.setPosition(latLng);
  }
}

/* ========= RUTA, DISTANCIA Y TIEMPO ========== */
function calcularRuta() {
  const origen  = document.getElementById("origen").value.trim();
  const destino = document.getElementById("destino").value.trim();

  if (!origen || !destino) return;

  directionsService.route(
    {
      origin: origen,
      destination: destino,
      travelMode: google.maps.TravelMode.DRIVING,
      drivingOptions: {
        departureTime: new Date(),
        trafficModel: google.maps.TrafficModel.BEST_GUESS
      }
    },
    (res, status) => {
      if (status === "OK" && res.routes && res.routes.length) {
        directionsRenderer.setDirections(res);

        const leg = res.routes[0].legs[0];
        document.getElementById("distancia").textContent =
          leg.distance ? leg.distance.text : "‚Äî";
        document.getElementById("tiempo").textContent =
          leg.duration_in_traffic
            ? leg.duration_in_traffic.text
            : (leg.duration ? leg.duration.text : "‚Äî");
      } else {
        console.error("Error al calcular ruta:", status, res);
        document.getElementById("distancia").textContent = "‚Äî";
        document.getElementById("tiempo").textContent   = "‚Äî";
      }
    }
  );
}

// Hacemos visible initMap al script de Google
window.initMap = initMap;
</script>

<!-- SCRIPT GOOGLE MAPS (con PLACES para Autocomplete) -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD32zkRd46s5jKHkTjj2868WOMfv7m_V48&libraries=places&callback=initMap"
  async
  defer
></script>

</body>
</html>
