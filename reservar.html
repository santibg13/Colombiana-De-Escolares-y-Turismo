<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#050508">
<title>Reservar ‚Äì COLESTUR</title>

<!-- EMAILJS CONFIG REAL -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init("BBBTYChL9Rq9ynJgJ"); /* ‚Üê TU PUBLIC KEY REAL */
</script>

<style>
  :root {
    --bg: #050508;
    --card: #0c0d11;
    --card-soft: #13141b;
    --accent: #3a7ce9;
    --text: #f4f6f9;
    --muted: #9ca3b5;
    --border: #1c1d25;
  }

  body {
    margin: 0; background: var(--bg);
    font-family: system-ui;
    color: var(--text);
  }

  header {
    padding: 16px; display: flex; align-items: center;
    gap: 12px; background: rgba(10,10,14,0.6);
    border-bottom: 1px solid #0e1015;
    position: sticky; top: 0; z-index: 50;
  }

  .logo-circle {
    width: 38px; height: 38px;
    background: linear-gradient(135deg,#ffeaa7,#f1c40f);
    border-radius: 999px; display: flex;
    justify-content: center; align-items: center;
    font-weight: 800; color:#111;
  }

  main {
    padding: 20px 16px 140px !important;
    max-width: 780px; margin: auto;
  }

  .trip-card {
    background: var(--card);
    padding: 18px; border-radius: 18px;
    border: 1px solid var(--border);
    margin-bottom: 22px;
  }

  input, select {
    width: 100%; padding: 12px;
    border-radius: 14px;
    background: var(--card-soft);
    border: 1px solid var(--border);
    color: var(--text);
  }

  #map { width:100%; height:300px;
    border-radius:18px; margin-bottom:18px;
    border:1px solid var(--border);
  }

  .info-box {
    background: var(--card); padding: 14px;
    border-radius:14px; border:1px solid var(--border);
    margin-bottom:20px;
  }

  .bottom-nav {
    position: fixed; bottom:0; left:0; right:0;
    height:65px; background:#0d0e12;
    border-top:1px solid #1f2027;
    display:flex; justify-content:space-around; align-items:center;
    z-index:99999;
  }

  .nav-item { color:#9ca3b5; text-decoration:none; text-align:center; }
  .nav-active { color:white!important; }
  .nav-item span { display:block; font-size:22px; }

  .confirm-container {
    position: fixed; bottom:75px;
    left:0; right:0; padding:0 18px;
    z-index:9999;
  }

  .btn-confirm {
    width:100%; padding:15px;
    background:var(--accent); border:none;
    border-radius:999px; color:white;
    font-size:16px; font-weight:700;
  }
</style>

</head>

<body>

<header>
  <div class="logo-circle">CR</div>
  <div>
    <div style="font-size:12px;color:var(--muted)">TRANSPORTE ESPECIAL</div>
    <div style="font-size:18px;font-weight:700">COLESTUR S.A.S.</div>
  </div>
</header>

<main>

  <section class="trip-card">
    <label>Punto de recogida</label>
    <input id="origen" placeholder="Cargando ubicaci√≥n..." />

    <label style="margin-top:14px;">Destino</label>
    <input id="destino" placeholder="¬øA d√≥nde vas?" />
  </section>

  <div id="map"></div>

  <div class="info-box">
    <div>üìç <b>Distancia:</b> <span id="distancia">‚Äî</span></div>
    <div>‚è± <b>Tiempo estimado:</b> <span id="tiempo">‚Äî</span></div>
  </div>

  <section class="trip-card">
    <label>Nombre completo</label>
    <input id="nombre"/>

    <label style="margin-top:12px;">WhatsApp</label>
    <input id="telefono" type="tel"/>

    <label style="margin-top:12px;">Servicio</label>
    <select id="servicio">
      <option>Escolar</option>
      <option>Empresarial</option>
      <option>Turismo</option>
      <option>Aeropuerto</option>
    </select>

    <label style="margin-top:12px;">Fecha</label>
    <input type="date" id="fecha"/>

    <label style="margin-top:12px;">Hora</label>
    <input type="time" id="hora"/>

    <label style="margin-top:12px;">Pasajeros</label>
    <input type="number" id="pasajeros" value="1" min="1"/>
  </section>

</main>

<div class="confirm-container">
  <button id="btnReservar" class="btn-confirm">Confirmar reserva</button>
</div>

<div class="bottom-nav">
  <a href="index.html" class="nav-item"><span>üè†</span>Inicio</a>
  <a href="reservar.html" class="nav-item nav-active"><span>üöå</span>Reservar</a>
  <a href="contacto.html" class="nav-item"><span>üìû</span>Contacto</a>
</div>

<!-- =========== MAPA + RUTAS + ENV√çO =========== -->
<script>
let map, directionsService, directionsRenderer;
let originLatLng = null, destLatLng = null;
let originMarker, destMarker;

function initMap() {

  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({
    suppressMarkers:true,
    polylineOptions:{ strokeColor:"#3a7ce9", strokeWeight:6 }
  });

  map = new google.maps.Map(document.getElementById("map"), {
    center:{lat:4.7, lng:-74.05},
    zoom:14,
    disableDefaultUI:true
  });

  directionsRenderer.setMap(map);

  navigator.geolocation.getCurrentPosition(pos => {

    originLatLng = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
    map.setCenter(originLatLng);

    const geo = new google.maps.Geocoder();
    geo.geocode({ location: originLatLng }, (res, status) => {
      if(status === "OK" && res[0]) {
        document.getElementById("origen").value = res[0].formatted_address;
      }
    });

    originMarker = new google.maps.Marker({
      position: originLatLng,
      map,
      icon:{
        path:google.maps.SymbolPath.CIRCLE,
        scale:8, fillColor:"#3a7ce9",
        fillOpacity:1, strokeColor:"#fff", strokeWeight:2
      }
    });

  });

  const acOptions = { fields:["geometry"], componentRestrictions:{ country:"co" }};

  const acOrigen = new google.maps.places.Autocomplete(origen, acOptions);
  const acDestino = new google.maps.places.Autocomplete(destino, acOptions);

  acOrigen.addListener("place_changed", ()=>{
    const p = acOrigen.getPlace();
    if(!p.geometry) return;

    originLatLng = p.geometry.location;

    if (!originMarker) originMarker = new google.maps.Marker({position:originLatLng,map});
    else originMarker.setPosition(originLatLng);

    calcularRuta();
  });

  acDestino.addListener("place_changed", ()=>{
    const p = acDestino.getPlace();
    if(!p.geometry) return;

    destLatLng = p.geometry.location;

    if (!destMarker) destMarker = new google.maps.Marker({position:destLatLng,map});
    else destMarker.setPosition(destLatLng);

    calcularRuta();
  });

  document.getElementById("btnReservar").addEventListener("click", ()=>{

    let data = {
      nombre: nombre.value,
      telefono: telefono.value,
      servicio: servicio.value,
      origen: origen.value,
      destino: destino.value,
      fecha: fecha.value,
      hora: hora.value,
      pasajeros: pasajeros.value
    };

    emailjs.send("service_bsdpr26", "template_fmqabdi", data)
      .then(()=>{ alert("Reserva enviada con √©xito üöÄ"); })
      .catch(()=>{ alert("Error enviando reserva"); });
  });

}

function calcularRuta(){
  if(!originLatLng || !destLatLng) return;

  directionsService.route({
    origin: originLatLng,
    destination: destLatLng,
    travelMode:"DRIVING",
    drivingOptions:{
      departureTime: new Date(),
      trafficModel:"pessimistic"
    }
  }, (res,status)=>{
    if(status==="OK"){
      directionsRenderer.setDirections(res);
      const leg = res.routes[0].legs[0];

      distancia.textContent = leg.distance.text;
      tiempo.textContent =
        leg.duration_in_traffic ? leg.duration_in_traffic.text : leg.duration.text;
    }
  });
}

window.initMap = initMap;
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD32zkRd46s5jKHkTjj2868WOMfv7m_V48&libraries=places&callback=initMap" async defer></script>

</body>
</html>
